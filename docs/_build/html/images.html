

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Image handling &mdash; Impresso PyCommons  documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Utilities" href="utils.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Impresso PyCommons
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="io.html">Input/Output</a></li>
<li class="toctree-l1"><a class="reference internal" href="rebuild.html">Text Rebuild</a></li>
<li class="toctree-l1"><a class="reference internal" href="utils.html">Utilities</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Image handling</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#module-impresso_commons.images.img_utils">Image Utils</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-impresso_commons.images.olive_boxes">Olive Boxes</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Impresso PyCommons</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Image handling</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/images.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="image-handling">
<h1>Image handling<a class="headerlink" href="#image-handling" title="Permalink to this headline">¶</a></h1>
<div class="section" id="module-impresso_commons.images.img_utils">
<span id="image-utils"></span><h2>Image Utils<a class="headerlink" href="#module-impresso_commons.images.img_utils" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="impresso_commons.images.img_utils.BoxStrategy">
<em class="property">class </em><code class="descclassname">impresso_commons.images.img_utils.</code><code class="descname">BoxStrategy</code><a class="headerlink" href="#impresso_commons.images.img_utils.BoxStrategy" title="Permalink to this definition">¶</a></dt>
<dd><p>An enumeration.</p>
</dd></dl>

<dl class="function">
<dt id="impresso_commons.images.img_utils.get_imgdimensions">
<code class="descclassname">impresso_commons.images.img_utils.</code><code class="descname">get_imgdimensions</code><span class="sig-paren">(</span><em>image_data</em><span class="sig-paren">)</span><a class="headerlink" href="#impresso_commons.images.img_utils.get_imgdimensions" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns image height and width</p>
</dd></dl>

</div>
<div class="section" id="module-impresso_commons.images.olive_boxes">
<span id="olive-boxes"></span><h2>Olive Boxes<a class="headerlink" href="#module-impresso_commons.images.olive_boxes" title="Permalink to this headline">¶</a></h2>
<p>Functions to support re-computation of Olive box coordinates.</p>
<dl class="function">
<dt id="impresso_commons.images.olive_boxes.compute_box">
<code class="descclassname">impresso_commons.images.olive_boxes.</code><code class="descname">compute_box</code><span class="sig-paren">(</span><em>scale_factor</em>, <em>input_box</em><span class="sig-paren">)</span><a class="headerlink" href="#impresso_commons.images.olive_boxes.compute_box" title="Permalink to this definition">¶</a></dt>
<dd><p>Compute IIIF box coordinates of input_box relative to scale_factor.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>scale_factor</strong> (<em>float</em>) – ratio between 2 images with different dimensions</li>
<li><strong>input_box</strong> (<em>str</em>) – string with 4 values separated by spaces</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">new box coordinates</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">str</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="impresso_commons.images.olive_boxes.compute_scale_factor">
<code class="descclassname">impresso_commons.images.olive_boxes.</code><code class="descname">compute_scale_factor</code><span class="sig-paren">(</span><em>img_source_path</em>, <em>img_dest_path</em><span class="sig-paren">)</span><a class="headerlink" href="#impresso_commons.images.olive_boxes.compute_scale_factor" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes x scale factor bewteen 2 images</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>img_source_path</strong> (<em>full path to the image</em>) – the source image</li>
<li><strong>img_dest_path</strong> (<em>full path to the image</em>) – the destination image</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">scale factor</p>
</td>
</tr>
</tbody>
</table>
<p>:rtype:float</p>
</dd></dl>

<dl class="function">
<dt id="impresso_commons.images.olive_boxes.convert_box">
<code class="descclassname">impresso_commons.images.olive_boxes.</code><code class="descname">convert_box</code><span class="sig-paren">(</span><em>input_box</em><span class="sig-paren">)</span><a class="headerlink" href="#impresso_commons.images.olive_boxes.convert_box" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert a box with [x y x y] coordinates to [x y w h]</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>input_box</strong> (<em>str</em>) – box with 4 coordinates, x and y upper left and lower right</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">box with 4 coordinates, x and y upper left, width and height</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">str</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="impresso_commons.images.olive_boxes.get_iiif_url">
<code class="descclassname">impresso_commons.images.olive_boxes.</code><code class="descname">get_iiif_url</code><span class="sig-paren">(</span><em>page_id</em>, <em>box</em><span class="sig-paren">)</span><a class="headerlink" href="#impresso_commons.images.olive_boxes.get_iiif_url" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns impresso iiif url given a page id and a box</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>page_id</strong> (<em>str</em>) – impresso page id, e.g. EXP-1930-06-10-a-p0001</li>
<li><strong>box</strong> (<em>str</em><em> (</em><em>4 coordinate values blank separated</em><em>)</em>) – iiif box (x, y, w, h)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">iiif url of the box</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">str</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="impresso_commons.images.olive_boxes.get_scale_factor">
<code class="descclassname">impresso_commons.images.olive_boxes.</code><code class="descname">get_scale_factor</code><span class="sig-paren">(</span><em>issue_dir_path</em>, <em>archive</em>, <em>page_xml</em>, <em>box_strategy</em>, <em>img_source_name</em><span class="sig-paren">)</span><a class="headerlink" href="#impresso_commons.images.olive_boxes.get_scale_factor" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the scale factor in Olive context, given a strategy to choose the source image.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>issue_dir_path</strong> (<em>str</em>) – the path of the issue</li>
<li><strong>archive</strong> (<em>zipfile.ZipFile</em>) – the zip archive</li>
<li><strong>page_xml</strong> (<em>bytes</em>) – the xml handler of the page</li>
<li><strong>box_strategy</strong> (<em>str</em>) – the box strategy such as found in the info.txt from jp2 folder</li>
<li><strong>img_source_name</strong> – as found in the info.txt from jp2 folder</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">the hopefully correct scale factor</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">float</p>
</td>
</tr>
</tbody>
</table>
<p>Olive box coordinates were computed according to an image source which we have to identify.
Image format coverage is different from issue to issue, and we have to devise strategies.</p>
<p>The tif is present and is the file from which the jp2 was converted.
Dest: Tif dimensions can therfore be used as jp2 dimensions, no need to read the jp2 file.
Source: Image source dimension is present in the page.xml (normally).</p>
<p>In this case the jp2 was acquired using the png with the highest dimension.
Dest: It looks that in case of several png, Olive also took the highest for the OCR. It is therefore
possible to rely on the resolution indicated in the page xml, which should be the same as our jp2.
N.B.: the page width and heigth indicated in the xml do not correspond (usually) to the highest
resolution png (there is therefore a discrepancy in Olive file between the tag ‘images_resolution’
on the one hand, and ‘page_width|height’on the other). It seems we can ignore this and rely on the
resolution only in the current case.
Source: the highest png
Here source and dest dimension are equals, the function returns 1.</p>
<p>To be checked if it happens.
In this case, there is no choice and Olive OCR and JP2 acquisition should be from the same source
=&gt; scale factor of 1.
Here we do an additional check to see if the page_width|height are the same as the image ones.
The only danger is if Olive used another image file and did not provide it.</p>
<p>Same as Case 3, scale factor of 1.
Here we do an additional check to see if the page_width|height are the same as the image ones.
(there is only one image and things should fit, not like in case 2)</p>
</dd></dl>

<dl class="function">
<dt id="impresso_commons.images.olive_boxes.test">
<code class="descclassname">impresso_commons.images.olive_boxes.</code><code class="descname">test</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#impresso_commons.images.olive_boxes.test" title="Permalink to this definition">¶</a></dt>
<dd><p>a testing function</p>
</dd></dl>

</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="utils.html" class="btn btn-neutral" title="Utilities" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, impresso - Media Monitoring of the Past - EPFL-DHLAB, UZH-ICL, UNILU-C2DH..

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>